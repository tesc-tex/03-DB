\subsection{%
  Лекция \texttt{23.10.06}.%
}

Соединение двух таблиц можно сделать через два вложенных цикла (обычно
медленно), либо через сортировку двух таблиц и проход по ним с помощью двух
указателей (как в сортировке слиянием). Второй способ обычно быстрее, кроме
случаев, когда в одной из таблиц очень мало записей, а в другой~--- очень много.

\begin{definition}
  \textit{Нормализация} --- это приведение отношения к нормальной форме.
  Она нужна, чтобы убрать избыточность и аномалии.
\end{definition}

Пусть есть \quote{плохое} отношение, в котором есть три атрибута: ФИО, Группа,
Образовательная программа (ОП). Сразу видно дублирование: связь группы и
образовательной программы хранится несколько раз, также есть избыточность: нам
достаточно знать группу, чтобы определить ОП.

\begin{definition}
  \textit{Аномалия модификации}: изменение значения одной записи повлечет за собой
  просмотр всей таблицы и изменение некоторых других записей
\end{definition}

\begin{example}
  Нужно сменить ОП для группы? Придется пройти по всем записям. Это долго, а
  также можно что-то пропустить.
\end{example}

\begin{definition}
  \textit{Аномалия удаления}: при удалении записи может пропасть и другая информация.
\end{definition}

\begin{example}
  Удаляем всех студентов из группы и теряем связь группы с ОП.
\end{example}

\begin{definition}
  \textit{Аномалия добавления}: информацию в таблицу нельзя поместить пока она 
  не полная или требуется дополнительный просмотр таблицу.
\end{definition}

\begin{example}
  Добавляем студента, который не знает ОП, а знает только группу.
\end{example}

\begin{definition}
  В отношении \(R\) атрибут \(y\) \textit{функционально зависит} от атрибута \(x \iff\)
  каждому \(x\) соответствует в точности один \(y\). В этом случае \(x\)
  называется детерминантом, а \(y\)~--- зависимой частью.
\end{definition}

\begin{definition}
  \textit{Частичная функциональная зависимость} --- это зависимость неключевого атрибута
  от части составного потенциального ключа.
\end{definition}

\begin{example}
  ОП частично функционально зависит от составного ключа ФИО-Группа.
\end{example}

\begin{definition}
  \textit{Полная функциональная зависимость} --- это зависимость неключевого атрибута от
  составного потенциального ключа.
\end{definition}

\begin{example}
  Если добавить в рассматриваем пример атрибут Форма обучения, то он будет полно
  функционально зависеть от составного ключа ФИО-Группа
\end{example}

\begin{definition}
  \textit{Транзитивная функциональная зависимость}: два атрибута находятся в транзитивной
  функциональной зависимости, если существует атрибут (множество атрибутов)
  такой, что второй атрибут находится в функциональной зависимости от этого
  атрибута, а сам этот атрибут функционально зависит от первого атрибута.

  Иными словами, если даны три множества \(A, B, C\) и
  \begin{enumerate}
    \item \(B\) зависит от \(A\),
    \item \(A\) не зависит от \(B\),
    \item \(C\) зависит от \(B\),
  \end{enumerate}
  то зависимость \(A \to C\) называется транзитивной. 

  \todo в тетради нет четкого определения
\end{definition}

\subheader{Нормальные формы}

Нормальные формы \quote{вложены} друг в друга: для того, чтобы отношение
находилось в определенной нормальной форме, оно должно находиться в предыдущей
нормальной форме и должно выполняться некоторое дополнительное условие. Названия
нормальный форм будем сокращать как (например) 1НФ~--- первая нормальная форма.

\begin{definition}[1НФ]
  \textit{Первая нормальная форма}: все атрибуты отношения являются \textit{простыми} 
  (не пытаемся использовать атрибуты как составные).
\end{definition}

\begin{definition}[2НФ]
  \textit{Вторая нормальная форма}: 1НФ и каждый неключевой атрибут 
  \textit{функционально полно} зависит от первичного ключа
  (то есть нет \textit{частичных} функциональных зависимостей).
\end{definition}

\begin{definition}[3НФ]
  \textit{Третья нормальная форма}: 2НФ и все неключевые атрибуты взаимнонезависимы и
  полностью зависят от первичного ключа.
\end{definition}

3НФ можно определить иначе:
\begin{definition}[3НФ]
  2НФ и ни один неключевой атрибут не находится в \textit{транзитивной} функциональной
  зависимости от потенциального ключа.
\end{definition}

\begin{remark}
  (На это необязательно смотреть!)

  Также есть другое эквивалентное определение, данное Карлом Заниоло:
  таблица находится в 3НФ тогда и только тогда, когда для каждой функциональной зависимости
  \(X \to Y\) выполнено одно из следующих условий
  \begin{enumerate}
    \item \(Y \subseteq X\) --- тривиальная зависимость
    \item \(X\) является суперключом
    \item каждый атрибут \(Y \setminus X\) является ключевым,
    то есть входит в состав какого-то потенциального ключа.
  \end{enumerate}

  Данная формулировка удобна тем, что переход к БКНФ осуществляется удалением последнего требования.
\end{remark}

\begin{definition}[БКНФ]
  \textit{Нормальная форма Бойса-Кодда (БКНФ)}: 3НФ и детерминанты всех зависимостей
  являются потенциальными ключами.
\end{definition}

\begin{example}
  Пусть есть отношение с атрибутами ИСУ, Паспорт, ID Проекта и Роль. ИСУ +
   ID Проекта и Паспорт + ID Проекта это первичные ключи. Если человек решит
   сменить паспорт, то он может сменить его относительно одного проекта, а
   относительно другого~--- забыть. Для решения этой проблемы следует разбить
   это отношение на два: ИСУ, ID Проекта, Роль и ИСУ, Паспорт.
\end{example}

\begin{definition}[4НФ]
  \textit{Четвертая нормальная форма}: БКНФ и отношение не содержит нетривиальных
  \textit{многозначных} зависимостей.
\end{definition}

\begin{example}
  Пусть есть отношение ID Дисциплины, ID Лектора, ID Практика. Если лектор решил
  уволится, то нужно везде заменить его, но можно ошибиться и поменять не везде.
  Можно попытаться разбить это отношение на два: ID Дисциплины, ID Лектора и ID
  Дисциплины, ID Практика, но тогда потеряется связь лектора и практика (а что
  если некоторые лекторы могут работать только с определенными практиками и
  наоборот?).
\end{example}

\begin{remark}
  Если в отношении два столбца, то оно находится во всех нормальных формах, т.к.
  его более нельзя разбить
\end{remark}

\begin{remark}
  Существуют также 5-я и 6-я нормальные формы, но они редко используются на
  практике. На практике же, наоборот, иногда прибегают к денормализации для
  повышения скорости работы.
\end{remark}
